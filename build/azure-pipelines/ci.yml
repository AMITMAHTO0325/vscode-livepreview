name: $(Date:yyyyMMdd)$(Rev:.r)

trigger:
  branches:
    include:
    - main
pr: none

pool:
  vmImage: ubuntu-latest

jobs:
- job:
  displayName: Compile
  steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "14.x"

  - bash: |
      echo "##vso[task.setvariable variable=sauce]crushed tomatoes"

  - script: |
      node -p "require(\"./package.json\").name + \"-\" + require(\"./package.json\").version + \".vsix\""

  # - bash: |
  #     PACKAGE_NAME=$(node -p "require(\"./package.json\").name + \"-\" + require(\"./package.json\").version + \".vsix\"")
  #     echo "##vso[task.setvariable variable=PackageName]$PACKAGE_NAME"
  #   displayName: Set package name

  # - bash: echo $(PACKAGE_NAME)

  - script: yarn install --frozen-lockfile
    displayName: Install dependencies

  - script: yarn run compile
    displayName: Compile

  - script: yarn eslint src
    displayName: Run ESLint

  - script: npx vsce package
    displayName: Package extension
